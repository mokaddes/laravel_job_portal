DROP TRIGGER IF EXISTS `AFTER_PRD_LISTINGS_INSERT`;
DELIMITER $$
CREATE TRIGGER `AFTER_PRD_LISTINGS_INSERT` AFTER INSERT ON `PRD_LISTINGS` FOR EACH ROW BEGIN

DECLARE VAR_TOTAL_LISTING INT(10) DEFAULT 0;
DECLARE VAR_TOTAL_TYPE_LISTING INT(10) DEFAULT 0;

SELECT COUNT(*) INTO VAR_TOTAL_LISTING FROM PRD_LISTINGS WHERE F_USER_NO = NEW.F_USER_NO AND STATUS <> 50 ;
SELECT COUNT(*) INTO VAR_TOTAL_TYPE_LISTING FROM PRD_LISTINGS WHERE F_PROPERTY_TYPE_NO = NEW.F_PROPERTY_TYPE_NO AND STATUS <> 50 ;

UPDATE WEB_USER SET TOTAL_LISTING =  VAR_TOTAL_LISTING WHERE PK_NO = NEW.F_USER_NO;
UPDATE PRD_PROPERTY_TYPE SET TOTAL_LISTING =  VAR_TOTAL_TYPE_LISTING WHERE PK_NO = NEW.F_PROPERTY_TYPE_NO;

END
$$
DELIMITER ;


DROP TRIGGER IF EXISTS `AFTER_PRD_LISTINGS_UPDATE`;
DELIMITER $$
CREATE TRIGGER `AFTER_PRD_LISTINGS_UPDATE` AFTER UPDATE ON `PRD_LISTINGS` FOR EACH ROW BEGIN

DECLARE VAR_TOTAL_LISTING INT(10) DEFAULT 0;
DECLARE VAR_TOTAL_TYPE_LISTING INT(10) DEFAULT 0;

SELECT COUNT(*) INTO VAR_TOTAL_LISTING FROM PRD_LISTINGS WHERE F_USER_NO = NEW.F_USER_NO AND STATUS <> 50 ;
SELECT COUNT(*) INTO VAR_TOTAL_TYPE_LISTING FROM PRD_LISTINGS WHERE F_PROPERTY_TYPE_NO = NEW.F_PROPERTY_TYPE_NO AND STATUS <> 50 ;

UPDATE WEB_USER SET TOTAL_LISTING =  VAR_TOTAL_LISTING WHERE PK_NO = NEW.F_USER_NO;
UPDATE PRD_PROPERTY_TYPE SET TOTAL_LISTING =  VAR_TOTAL_TYPE_LISTING WHERE PK_NO = NEW.F_PROPERTY_TYPE_NO;

END
$$
DELIMITER ;